---
생성일자: 2023-12-02
tags:
  - typescript/typia
---

# 참고
- [typia playground](https://typia.io/playground/?script=JYWwDg9gTgLgBDAnmYBDOAzKERwERIqp4DcAUGQKYAekscwAdjJVBqgMaVwCSAQgCMAzgEFYwDgBtuAbzJw4AegBUy+QuVwAClFCooiOAGlKiAHTq4ahVbgABDNBCp4AV1fAAJpeWL1XgC44IRhdRgBzcnUVaw04ABlgELgIDDgXGE4AC0pPTGBpIQsbWNs7ECYeFhAhOABGHz8FDALKISCeERhMjiyQSmYAMVaAbQBdOAAfOEZXSUkohRifOAAVYBhpFLSYHPTxKUpijRXypniB8N24AFZT52oLiOu6gAZXxvUYDekgkLDwlMZnMFhQlqoVgBZVBMOAcCDMAbwAQQTyGVIIPb6b6HY5WJpwFFov6hJiRMFKCElOAAYSglBcwARCFA3Ax2Ik0jxpU0DicLjgnhclAAtN9+p8FBx6cLPAB9FwkgHkAC+FBodHgTBYbE43E63Wy-SGrTgcnBPLgwy2jFQ-W5pzAGVYjDgAD0RqgRQAvV4igCcYwA1AASe6oR6Xa4AJhudxKBNt-SVZKBs3mi0plut3BoLEYQiZjAd1LsTu6Lvdnp9fsDofDkeeWTgAA5JXA8wNCwiUxE0yDM8tqQBVABK8W2mO4LS5PlOjigzjcunbrigkl75LVVFo0Hg8IL8FQQiErBgYhxWwAvAhkGgzNKGSwRCezwAefjCC+cygAPgAFAAlOQQA)

# 소개
[[1. Nestia 소개| Nestia]] (NestJS helper libraries)내부에서 유효성검사를 위해 typia 를 사용하는데 다른 라이브러리에 비해 정말로 빠른지 궁금해졌다.

typescript run time validation library (typia, ajv, class-validator)를 비교해보자.

[[5. Typia가 TS runtime validator 중 가장 빠른 이유]]

---

# 속도비교
![[Pasted image 20231205000207.png]]
위 그래프는 세 가지 유효성 검증 라이브러리 (`typia`, `ajv`, `class-validator`)의 실행 속도를 비교한 것입니다. 각 라이브러리별로 소요된 시간(밀리초 단위)이 막대 그래프로 표시되어 있습니다.

각 라이브러리 validation 함수 100만번 실행시 소요시간
- `typia`는 가장 빠른 실행 시간을 보여주며, 약 219.008 밀리초가 소요되었습니다.
- `ajv`는 중간 정도의 실행 시간을 나타내며, 약 429.958 밀리초가 소요되었습니다.
- `class-validator`는 세 라이브러리 중 가장 느린 실행 시간을 보여주며, 약 645.115 밀리초가 소요되었습니다.

---
# typia

## source code
```ts
import { tags, is } from "typia";

interface IBbsArticle {
  id: string & tags.Format<"uuid">;
  title: null | (string & tags.MinLength<5> & tags.MaxLength<100>);
  body: string;
  created_at: string & tags.Format<"date-time">;
}

const article: IBbsArticle = {
  id: "123e4567-e89b-12d3-a456-426655440000",
  title: "Hello, world!",
  body: "This is a test article.",
  created_at: "2020-01-01T00:00:00Z",
};

console.time("typia-validation");
for (let i = 0; i < 1000000; i++) {
  is<IBbsArticle>(article);
}
console.timeEnd("typia-validation");

```

## compiled code
```js
"use strict";

Object.defineProperty(exports, "__esModule", { value: true });

const typia_1 = require("typia");
const article = {
  id: "123e4567-e89b-12d3-a456-426655440000",
  title: "Hello, world!",
  body: "This is a test article.",
  created_at: "2020-01-01T00:00:00Z",
};

console.time("typia-validation");
for (let i = 0; i < 1000000; i++) {
  ((input) => {
    const $io0 = (input) =>
      "string" === typeof input.id &&
      /^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i.test(
        input.id
      ) &&
      (null === input.title ||
        ("string" === typeof input.title &&
          5 <= input.title.length &&
          input.title.length <= 100)) &&
      "string" === typeof input.body &&
      "string" === typeof input.created_at &&
      !isNaN(new Date(input.created_at).getTime());
    return "object" === typeof input && null !== input && $io0(input);
  })(article);
}
console.timeEnd("typia-validation");
```

## validation 속도
```shell
$ node main.js
typia-validation: 219.008ms
```

---

# ajv

## source code
```ts
import Ajv, { JSONSchemaType } from "ajv";
import addFormats from "ajv-formats";

interface IBbsArticle {
  id: string;
  title?: string;
  body: string;
  created_at: string;
}

const articleSchema: JSONSchemaType<IBbsArticle> = {
  type: "object",
  properties: {
    id: { type: "string", format: "uuid" },
    title: { type: "string", minLength: 5, maxLength: 100, nullable: true },
    body: { type: "string" },
    created_at: { type: "string", format: "date-time" },
  },
  required: ["id", "body", "created_at"],
  additionalProperties: false,
};

// Ajv 인스턴스 생성
const ajv = new Ajv();
addFormats(ajv);
const validateArticle = ajv.compile(articleSchema);

// 검증할 객체
const article: IBbsArticle = {
  id: "123e4567-e89b-12d3-a456-426655440000",
  title: "Hello, world!",
  body: "This is a test article.",
  created_at: "2020-01-01T00:00:00Z",
};

console.time("ajv-validation");
for (let i = 0; i < 1000000; i++) {
  validateArticle(article);
}
console.timeEnd("ajv-validation");
```

## compiled code
```js
"use strict";

var __importDefault =
  (this && this.__importDefault) ||
  function (mod) {
    return mod && mod.__esModule ? mod : { default: mod };
  };

Object.defineProperty(exports, "__esModule", { value: true });

const ajv_1 = __importDefault(require("ajv"));

const ajv_formats_1 = __importDefault(require("ajv-formats"));

const articleSchema = {
  type: "object",
  properties: {
    id: { type: "string", format: "uuid" },
    title: { type: "string", minLength: 5, maxLength: 100, nullable: true },
    body: { type: "string" },
    created_at: { type: "string", format: "date-time" },
  },
  required: ["id", "body", "created_at"],
  additionalProperties: false,
};

// Ajv 인스턴스 생성
const ajv = new ajv_1.default();
(0, ajv_formats_1.default)(ajv);
const validateArticle = ajv.compile(articleSchema);

// 검증할 객체
const article = {
  id: "123e4567-e89b-12d3-a456-426655440000",
  title: "Hello, world!",
  body: "This is a test article.",
  created_at: "2020-01-01T00:00:00Z",
};

console.time("ajv-validation");
for (let i = 0; i < 1000000; i++) {
  validateArticle(article);
}
console.timeEnd("ajv-validation");
```

## validation 속도
```shell
$ node main.js
ajv-validation: 429.958ms
```

---

# class-validator

## source code
```ts
import {
  IsUUID,
  IsString,
  Length,
  IsDateString,
  IsOptional,
  validate,
} from "class-validator";

class BbsArticleClass {
  @IsUUID()
  id: string = "";

  @IsString()
  @Length(5, 100)
  @IsOptional()
  title?: string;

  @IsString()
  body: string = "";

  @IsDateString()
  created_at: string = "";
}

const article: BbsArticleClass = {
  id: "123e4567-e89b-12d3-a456-426655440000",
  title: "Hello, world!",
  body: "This is a test article.",
  created_at: "2020-01-01T00:00:00Z",
};

console.time("class-validator-validation");

for (let i = 0; i < 1000000; i++) {
  validate(article);
}
console.timeEnd("class-validator-validation");
```

## compiled code
```js
"use strict";
var __decorate =
  (this && this.__decorate) ||
  function (decorators, target, key, desc) {
    var c = arguments.length,
      r =
        c < 3
          ? target
          : desc === null
          ? (desc = Object.getOwnPropertyDescriptor(target, key))
          : desc,
      d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function")
      r = Reflect.decorate(decorators, target, key, desc);
    else
      for (var i = decorators.length - 1; i >= 0; i--)
        if ((d = decorators[i]))
          r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
  };
var __metadata =
  (this && this.__metadata) ||
  function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function")
      return Reflect.metadata(k, v);
  };
Object.defineProperty(exports, "__esModule", { value: true });
const class_validator_1 = require("class-validator");
class BbsArticleClass {
  constructor() {
    this.id = "";
    this.body = "";
    this.created_at = "";
  }
}
__decorate(
  [(0, class_validator_1.IsUUID)(), __metadata("design:type", String)],
  BbsArticleClass.prototype,
  "id",
  void 0
);
__decorate(
  [
    (0, class_validator_1.IsString)(),
    (0, class_validator_1.Length)(5, 100),
    (0, class_validator_1.IsOptional)(),
    __metadata("design:type", String),
  ],
  BbsArticleClass.prototype,
  "title",
  void 0
);
__decorate(
  [(0, class_validator_1.IsString)(), __metadata("design:type", String)],
  BbsArticleClass.prototype,
  "body",
  void 0
);
__decorate(
  [(0, class_validator_1.IsDateString)(), __metadata("design:type", String)],
  BbsArticleClass.prototype,
  "created_at",
  void 0
);
const article = {
  id: "123e4567-e89b-12d3-a456-426655440000",
  title: "Hello, world!",
  body: "This is a test article.",
  created_at: "2020-01-01T00:00:00Z",
};
console.time("class-validator-validation");
for (let i = 0; i < 1000000; i++) {
  (0, class_validator_1.validate)(article);
}
console.timeEnd("class-validator-validation");
```

## validation 속도
```shell
$ node main.js
class-validator-validation: 645.115ms
```
